<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bouncing Particles — CSW 38</title>
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --accent:#60a5fa;
    --muted:#94a3b8;
    --font:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071022);font-family:var(--font);color:var(--muted);}
  header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:rgba(255,255,255,0.02);backdrop-filter:blur(4px);position:fixed;inset:0 0 auto 0;z-index:20;}
  .title{display:flex;flex-direction:column;gap:2px}
  .title .main{color:#fff;font-weight:600;font-size:16px}
  .title .sub{font-size:12px;color:var(--muted)}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:linear-gradient(180deg,var(--panel),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.03);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer;font-size:13px}
  .btn:active{transform:translateY(1px)}
  #ui{position:fixed;right:14px;top:68px;z-index:18;background:rgba(11,18,32,0.6);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);backdrop-filter:blur(6px);color:var(--muted)}
  #ui label{display:block;font-size:12px;margin-bottom:6px}
  #ui input[type="range"]{width:180px}
  canvas{display:block;width:100vw;height:100vh;object-fit:cover}
  footer{position:fixed;left:12px;bottom:12px;color:var(--muted);font-size:12px}
  a.link{color:var(--accent);text-decoration:none;border-bottom:1px dashed rgba(96,165,250,0.2)}
</style>
</head>
<body>
<header>
  <div class="title">
    <div class="main">Bouncing Particles — CSW 38</div>
    <div class="sub">Stage 1–3: single-file implementation with interaction</div>
  </div>
  <div class="controls">
    <button id="pauseBtn" class="btn">Pause</button>
    <button id="resetBtn" class="btn">Reset</button>
  </div>
</header>

<canvas id="canvas"></canvas>

<div id="ui">
  <label>Particles: <span id="countLabel">100</span></label>
  <input id="countRange" type="range" min="10" max="500" value="100" />
  <label style="margin-top:8px">Mouse Radius: <span id="mouseRadiusLabel">80</span></label>
  <input id="mouseRadius" type="range" min="20" max="200" value="80" />
  <label style="margin-top:8px">Max Speed: <span id="speedLabel">2.5</span></label>
  <input id="speedRange" type="range" min="0.2" max="6" step="0.1" value="2.5" />
</div>

<footer>
  Save as FirstInitial.LastName.part_3.htm • <a class="link" href="#" id="pageLink">Alternative page (not required)</a>
</footer>

<script>
/* Single-file particle system covering Stage 1–3 */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d', { alpha: true });

let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;
const DPR = Math.max(1, window.devicePixelRatio || 1);
canvas.width = W * DPR;
canvas.height = H * DPR;
canvas.style.width = W + 'px';
canvas.style.height = H + 'px';
ctx.scale(DPR, DPR);

let particles = [];
let animationId = null;
let paused = false;

/* UI references */
const countRange = document.getElementById('countRange');
const countLabel = document.getElementById('countLabel');
const mouseRadiusInput = document.getElementById('mouseRadius');
const mouseRadiusLabel = document.getElementById('mouseRadiusLabel');
const speedRange = document.getElementById('speedRange');
const speedLabel = document.getElementById('speedLabel');
const pauseBtn = document.getElementById('pauseBtn');
const resetBtn = document.getElementById('resetBtn');

countLabel.textContent = countRange.value;
mouseRadiusLabel.textContent = mouseRadiusInput.value;
speedLabel.textContent = speedRange.value;

/* mouse tracker for Stage 3 */
const mouse = { x: -9999, y: -9999, radius: Number(mouseRadiusInput.value) };

/* utilities */
function rand(min, max){ return Math.random() * (max - min) + min; }
function dist(x1,y1,x2,y2){ const dx = x1-x2, dy = y1-y2; return Math.sqrt(dx*dx + dy*dy); }
function hslToCss(h,s,l){ return `hsl(${h} ${s}% ${l}%)`; }

/* Particle class */
class Particle {
  constructor(x,y,r, color, dx, dy){
    this.x = x; this.y = y;
    this.radius = r;
    this.baseRadius = r;
    this.color = color;
    this.dx = dx; this.dy = dy;
    this.growth = 0; // used for smooth interpolation
  }

  draw(ctx){
    ctx.beginPath();
    ctx.fillStyle = this.color;
    ctx.arc(this.x, this.y, this.radius + this.growth, 0, Math.PI * 2);
    ctx.fill();
  }

  update(canvasW, canvasH){
    this.x += this.dx;
    this.y += this.dy;

    /* edge detection and bounce */
    if (this.x - (this.radius + this.growth) <= 0){
      this.x = this.radius + this.growth;
      this.dx *= -1;
    } else if (this.x + (this.radius + this.growth) >= canvasW){
      this.x = canvasW - (this.radius + this.growth);
      this.dx *= -1;
    }
    if (this.y - (this.radius + this.growth) <= 0){
      this.y = this.radius + this.growth;
      this.dy *= -1;
    } else if (this.y + (this.radius + this.growth) >= canvasH){
      this.y = canvasH - (this.radius + this.growth);
      this.dy *= -1;
    }

    /* mouse interaction: grow if close */
    const d = dist(this.x, this.y, mouse.x, mouse.y);
    const threshold = mouse.radius;
    const maxExtra = this.baseRadius * 2.2;
    if (d < threshold){
      const pct = 1 - (d / threshold);
      const target = maxExtra * pct;
      /* smooth approach */
      this.growth += (target - this.growth) * 0.18;
    } else {
      this.growth += (0 - this.growth) * 0.12;
    }
  }
}

/* create particles */
function createParticles(count){
  particles = [];
  const maxSpeed = Number(speedRange.value);
  for (let i = 0; i < count; i++){
    const r = rand(4, 14);
    const x = rand(r, W - r);
    const y = rand(r, H - r);
    const hue = Math.floor(rand(180, 260));
    const sat = Math.floor(rand(60, 90));
    const light = Math.floor(rand(50, 70));
    const color = hslToCss(hue, sat, light);
    const dx = rand(-maxSpeed, maxSpeed);
    const dy = rand(-maxSpeed, maxSpeed);
    particles.push(new Particle(x,y,r,color,dx || 0.6,dy || 0.6));
  }
}

/* draw background gradient with subtle vignette */
function drawBackground(){
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'rgba(6,10,18,0.34)');
  g.addColorStop(1,'rgba(2,6,12,0.8)');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,W,H);

  /* subtle vignette */
  const vg = ctx.createRadialGradient(W/2, H/2, Math.max(W,H)/6, W/2, H/2, Math.max(W,H)/1.2);
  vg.addColorStop(0,'rgba(0,0,0,0)');
  vg.addColorStop(1,'rgba(0,0,0,0.35)');
  ctx.fillStyle = vg;
  ctx.fillRect(0,0,W,H);
}

/* main loop */
function animate(){
  if (paused){
    animationId = requestAnimationFrame(animate);
    return;
  }
  ctx.clearRect(0,0,W,H);
  drawBackground();

  for (let p of particles){
    p.update(W, H);
    p.draw(ctx);
  }

  animationId = requestAnimationFrame(animate);
}

/* event handlers */
canvas.addEventListener('mousemove', (e) => {
  const rect = canvas.getBoundingClientRect();
  mouse.x = e.clientX - rect.left;
  mouse.y = e.clientY - rect.top;
});

canvas.addEventListener('mouseleave', () => {
  mouse.x = -9999; mouse.y = -9999;
});

window.addEventListener('resize', () => {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
  canvas.width = W * DPR;
  canvas.height = H * DPR;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
  createParticles(Number(countRange.value));
});

/* UI interactions */
countRange.addEventListener('input', () => {
  const val = Number(countRange.value);
  countLabel.textContent = val;
  // regenerate to match new count while preserving other settings
  createParticles(val);
});

mouseRadiusInput.addEventListener('input', () => {
  mouse.radius = Number(mouseRadiusInput.value);
  mouseRadiusLabel.textContent = mouseRadiusInput.value;
});

speedRange.addEventListener('input', () => {
  speedLabel.textContent = speedRange.value;
  // update particle velocities proportionally
  const sp = Number(speedRange.value);
  for (let p of particles){
    const signX = Math.sign(p.dx) || (Math.random() < 0.5 ? -1 : 1);
    const signY = Math.sign(p.dy) || (Math.random() < 0.5 ? -1 : 1);
    p.dx = rand(sp * 0.4, sp) * signX;
    p.dy = rand(sp * 0.4, sp) * signY;
  }
});

pauseBtn.addEventListener('click', () => {
  paused = !paused;
  pauseBtn.textContent = paused ? 'Resume' : 'Pause';
});

resetBtn.addEventListener('click', () => {
  createParticles(Number(countRange.value));
});

/* small helper link action (not required for core assignment) */
document.getElementById('pageLink').addEventListener('click', (e)=>{
  e.preventDefault();
  alert('Extra page not created in this single-file submission. Create a second HTML file for extra credit.');
});

/* init */
createParticles(Number(countRange.value));
animate();
</script>
</body>
</html>
